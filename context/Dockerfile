######################################
# docker-smw-crc1153                 #
######################################

ARG OPENRESEARCH_STACK=1.39.13-003
FROM ghcr.io/tibhannover/openresearch-stack:${OPENRESEARCH_STACK}

USER www-data
RUN \
    #
    #
    ### ConfirmAccount (2025-03-10)
    # last version that supports 1.39
    get-github-extension.sh ConfirmAccount 5c8c0ca2fc0fd27d2388b407de7f7a7fac6e9e9b wikimedia/mediawiki-extensions-ConfirmAccount && \
    #
    #
    ### EditAccount (2025-02-20)
    get-github-extension.sh EditAccount 4bc14fa01ae997a492a7189a061218834188f231 gesinn-it-pub/EditAccount && \
    #
    #
    ### KnowledgeGraph (2025-08-06)
    # get-github-extension.sh KnowledgeGraph 0fef81f5c70cb5ad6165d0bd22bb973eac06b44e gesinn-it-ilm/KnowledgeGraph 
    get-github-extension.sh KnowledgeGraph 557c7ff132891b2619dfe48d8ed2f76cce0fca9c SemanticMediaWiki/KnowledgeGraph

RUN composer-update.sh
USER root

######################################
# add SMW-CRC1153 settings        #
######################################
ADD --chown=www-data:www-data LocalSettings.Include.php /var/www/html/.
ADD --chown=www-data:www-data LocalSettings.SMW1153 /var/www/html/LocalSettings.SMW1153

# Global styles
#COPY mediawiki-global-styles/styles/* /var/www/html/resources/src/mediawiki.gesinn-it.global.styles/

#COPY media /var/www/html/_custom/media
#COPY styles /var/www/html/_custom/styles
######################################
# add style files                    #
######################################
# COPY --chown=www-data:www-data mediawiki-global-styles/styles/* /var/www/html/resources/src/mediawiki.gesinn-it.global.styles/
COPY --chown=www-data:www-data media /var/www/html/resources/src/mediawiki.smw1153.media/
COPY --chown=www-data:www-data styles/* /var/www/html/resources/src/mediawiki.smw1153.styles/

######################################
# run as http://localhost:8080		 #
######################################
ENV WIKI_DOMAIN=localhost
ENV WIKI_PORT=8080

######################################
# set smw-crc1153 version     		 #
######################################
ARG SMW-CRC1153_VERSION=2.0.0-beta4
RUN echo $SMW-CRC1153_VERSION > smw-crc1153-version.txt && \
    echo "\$wgSmwCrc1153Version = '$SMW-CRC1153_VERSION';" >> LocalSettings.Include.php
